{"mappings":"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","sources":["public/js/mapBox.js","public/js/alerts.js","public/js/updateSettings.js","public/js/index.js","public/js/login.js","public/js/stripe.js"],"sourcesContent":["/* eslint-disable */\r\n// const locations = JSON.parse(document.getElementById('map').dataset.locations);\r\n// console.log(locations);\r\n\r\nexport const displayMap = (locations) => {\r\n  mapboxgl.accessToken = \r\n'pk.eyJ1IjoiZXJpY21ha3VhbiIsImEiOiJjbDI2MDNrbXkwMG92M2VwcjcyYzd1NjNxIn0.WdTFpMinvB4osoD_4A3TMw';\r\n\r\nvar map = new mapboxgl.Map({\r\n  container: 'map',\r\n  style: 'mapbox://styles/ericmakuan/cl261xcs2000o16nvtlmqcbbo',\r\n  scrollZoom: false//使地圖不能被滾輪滾動\r\n  // center: [-118.113491, 34.111745],\r\n  // zoom: 10,\r\n  // interactive: false\r\n}); \r\n\r\nconst bounds = new mapboxgl.LngLatBounds(); \r\n\r\nlocations.forEach(loc => {\r\n  //create marker \r\n  const el = document.createElement('div');\r\n  el.classname = 'marker';\r\n  \r\n  //add marker\r\n  new mapboxgl.Marker({\r\n    elment: el,\r\n    anchor: 'bottom'//圖示的下面為點\r\n  }).setLngLat(loc.coordinates).addTo(map);\r\n\r\n  //add popup\r\n  new mapboxgl.Popup({\r\n    offset: 30\r\n  })\r\n  .setLngLat(loc.coordinates)\r\n  .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n  .addTo(map);\r\n  //extend map bounds tp include current location\r\n  bounds.extend(loc.coordinates);\r\n\r\n});\r\n\r\nmap.fitBounds(bounds, { \r\n    padding: {  //選取合適範圍\r\n    top: 200,\r\n    bottom: 150,\r\n    left: 100,\r\n    right: 100\r\n    }\r\n});\r\n}\r\n\r\n","/* eslint-disable */\r\n\r\nexport const hideAlert = () => {\r\n    const el = document.querySelector('.alert');\r\n    if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n//type is succes or error;\r\nexport const showAlert = (type, msg) => {\r\n  hideAlert();\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\r\n  window.setTimeout(hideAlert, 5000);\r\n};","import { showAlert } from './alerts';\r\n\r\n//type is either password or data\r\nexport const updateSettings = async (data, type) => {\r\n    try {\r\n        const url = type === 'password' \r\n        ? '/api/v1/users/updateMyPassword'\r\n        : '/api/v1/users/updateMe'\r\n        const res = await axios({  //外接\r\n         method: 'PATCH',\r\n         url,\r\n         data\r\n         \r\n     });\r\n \r\n     if (res.data.status==='success') {\r\n       showAlert('success', `${type.toUpperCase()} Data updated successfully!`);\r\n    //    window.setTimeout(() => {\r\n    //      location.assign('/');\r\n    //    }, 1500)\r\n     }\r\n \r\n   } catch (err) {\r\n     showAlert('error', err.response.data.message);\r\n   };\r\n}","/* eslint-disable */\r\n// import '@babel/polyfill' //使JS能相容\r\nimport { displayMap } from './mapBox';\r\nimport { login, logout } from './login';\r\nimport { updateSettings } from './updateSettings';\r\nimport { bookTour  } from './stripe'\r\n\r\n// DOM elements \r\nconst mapBox = document.getElementById('map')\r\nconst loginForm = document.querySelector('.form--login')\r\nconst logOutBtn = document.querySelector('.nav__el--logout'); \r\nconst userDataForm =  document.querySelector('.form-user-data')\r\nconst userPasswordForm =  document.querySelector('.form-user-password')\r\nconst bookBtn = document.getElementById('book-tour');\r\n\r\n//values\r\n\r\n\r\n//delegation\r\nif (mapBox) {\r\n    const locations = JSON.parse(mapBox.dataset.locations);\r\n\r\n    displayMap(locations);\r\n}\r\n\r\n\r\nif(loginForm)\r\n  loginForm.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    const email = document.getElementById('email').value;\r\n    const password = document.getElementById('password').value;\r\n    login(email, password)\r\n});\r\n\r\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\r\n\r\nif (userDataForm)\r\n  userDataForm.addEventListener('submit', e => {\r\n    e.preventDefault();\r\n    const form = new FormData();\r\n    form.append('name', document.getElementById('name').value);\r\n    form.append('email', document.getElementById('email').value);\r\n    form.append('photo', document.getElementById('photo').files[0]); //檔案\r\n\r\n    updateSettings(form, 'data');\r\n});\r\n\r\nif (userPasswordForm)\r\n  userPasswordForm.addEventListener('submit', async e => {\r\n    e.preventDefault();\r\n    document.querySelector('.btn--save-password').textContent = 'Updating...'\r\n    const passwordCurrent = document.getElementById('password-current').value;\r\n    const password = document.getElementById('password').value;\r\n    const passwordConfirm = document.getElementById('password-confirm').value;\r\n    await updateSettings({passwordCurrent, password, passwordConfirm}, 'password');\r\n    \r\n    document.querySelector('.btn--save-password').textContent = 'Save password'\r\n    document.getElementById('password-current').value = '';\r\n    document.getElementById('password').value = '';\r\n    document.getElementById('password-confirm').value = '';\r\n});\r\n\r\nif  (bookBtn)\r\n  bookBtn.addEventListener('click', e => {\r\n    e.target.textContent = 'Processing...'\r\n    const { tourId } = e.target.dataset;\r\n    bookTour(tourId);\r\n  })","/* eslint-disable */\r\n// import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const login = async (email, password) => { //js方法\r\n\r\n    try {\r\n       const res = await axios({  //外接\r\n        method: 'POST',\r\n        url: '/api/v1/users/login', //API跟網站視同個URL可用\r\n        // url: 'http://127.0.0.1:3000/api/v1/users/login',\r\n        data: {\r\n            email: email, \r\n            password: password\r\n        }\r\n    });\r\n\r\n    if (res.data.status==='success') {\r\n      showAlert('success', 'Logged in successfully!');\r\n      window.setTimeout(() => {\r\n        location.assign('/');\r\n      }, 1500)\r\n    }\r\n\r\n  } catch (err) {\r\n    showAlert('error', err.response.data.message);\r\n  };\r\n};\r\n\r\nexport const logout = async () => {\r\n  try{\r\n    const res = await axios({\r\n      method: 'GET',\r\n      url: '/api/v1/users/logout',\r\n      \r\n    });\r\n\r\n    if(res.data.status='success') location.reload(true);//重整\r\n  } catch (err) {\r\n    showAlert('error', 'Error logging out!')\r\n  }\r\n}\r\n","/* eslint-disable */\r\n// import axios from 'axios';\r\nimport { showAlert } from './alerts';\r\n\r\nexport const bookTour = async tourId => {\r\n    const stripe = Stripe('pk_test_51KrjIOES5f5ekGm525NKnMRkMBoaib7OCe11RiiBKaDoqaCSpfnwyn6V1LlcPQvZw4cKk3wHOWPiHkBlrQJL98DU00wDI33SI2'); // <==== PUT THE VARIABLE HERE\r\n \r\n    try {\r\n        // 1. Get checkout session from the API\r\n        const session = await axios(\r\n            `/api/v1/bookings/checkout-session/${tourId}`\r\n        );\r\n        // console.log(session);\r\n \r\n        // 2. Create checkout form + charge credit card\r\n        await stripe.redirectToCheckout({\r\n            sessionId: session.data.session.id\r\n        });\r\n    } catch (err) {\r\n        console.log(err);\r\n        showAlert('error', err);\r\n    }\r\n};"],"names":["$ae043a07925b9161$export$5a81baf3e1f8b5bb","el","document","querySelector","parentElement","removeChild","$ae043a07925b9161$export$e2ed28791945543d","type","msg","markup","insertAdjacentHTML","window","setTimeout","$5792b2e1ba13db18$export$81acc09c7bdb4525","async","data","url","axios","method","status","toUpperCase","err","response","message","$76e1b8da06735788$var$mapBox","getElementById","$76e1b8da06735788$var$loginForm","$76e1b8da06735788$var$logOutBtn","$76e1b8da06735788$var$userDataForm","$76e1b8da06735788$var$userPasswordForm","$76e1b8da06735788$var$bookBtn","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","classname","Marker","elment","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$0eee7153958b8a9d$export$976c4dce80bbf3f7","JSON","parse","dataset","addEventListener","e","preventDefault","email","password","location","assign","$7cc7f8af1b68db3e$export$4a142f624dd0fa8","value","reload","form","FormData","append","files","textContent","passwordCurrent","passwordConfirm","target","tourId","stripe","Stripe","session","redirectToCheckout","sessionId","id","console","log","$d8bb589ac7bfe8e7$export$54ca10ceadf03905"],"version":3,"file":"index.js.map"}